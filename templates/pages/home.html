{% extends 'base.html' %}

{% block content %}


<div class = 'row text-center'>
    <div class = 'col'>
        <h3>Welcome to Tweet Me App</h3>
    </div>
</div>

 <div id = 'tweets'>
     Loading....
 </div>



<script>

    function handleDidLike(tweet_id,currentCount){
        console.log(currentCount)
    }

    function LikeBtn(tweet){
        return "<button class = 'btn btn-primary' onclick=handleDidLike("+tweet.id +","+ tweet.likes +")>" + tweet.likes +" Likes</button>"
    }

    function formatTweetElement(tweet){
        var formattedTweet = "<div class = 'col-12 col-md-10 border mx-auto rounded py-3 mb-4 tweet' id = 'tweet - " + tweet.id + "'><p>" + tweet.content + "</p><div class = 'btn-group'>" + LikeBtn(tweet) +"</p></div></div>"
        return formattedTweet
    }

    const tweetsElement = document.getElementById("tweets")
    const xhr = new XMLHttpRequest()
    const method = 'GET'
    const url = '/tweets'
    const responseType = 'json'

    xhr.responseType = responseType
    xhr.open(method,url)
    xhr.onload = function(){
        console.log(xhr.response)
        const serverResponse = xhr.response
        const ListedItems = serverResponse.response
        var finalTweetStr=''
        var i = 0 
        for(i=0;i<ListedItems.length;i++){
            console.log(ListedItems[i])
            var current = formatTweetElement(ListedItems[i])
            finalTweetStr += current
        }
        tweetsElement.innerHTML = finalTweetStr
    }
    xhr.send()

</script>

{% endblock content %}